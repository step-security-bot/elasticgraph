<!DOCTYPE html>
<html lang="en" class="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ElasticGraph Query API: Filter Conjunctions</title>
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/highlight.css">
</head>

<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 flex flex-col h-screen">
  <!-- Navbar -->
<nav class="w-full py-4 bg-gray-200 dark:bg-gray-800 shadow">
  <div class="container mx-auto flex justify-between items-center px-4">
    <div class="text-xl flex items-center space-x-4">
      <a href="/" class="font-bold hover:underline">ElasticGraph</a>
      <a href="/docs/main" class="text-blue-600 dark:text-blue-400 hover:underline">Docs</a>
      <a href="/query-api" class="text-blue-600 dark:text-blue-400 hover:underline">Query API</a>
    </div>
    <div>
      <a href="https://github.com/block/elasticgraph" target="_blank"
        class="text-blue-600 dark:text-blue-400 hover:underline mr-2">GitHub</a>
      <a href="/about" class="text-blue-600 dark:text-blue-400 hover:underline">About</a>
    </div>
  </div>

  <!-- Breadcrumbs -->
  <div class="container mx-auto px-4 mt-2">
    <nav class="text-base text-gray-600 dark:text-gray-400" aria-label="Breadcrumb">
      <ol class="list-reset flex">
        
        <li>
          <a href="/" class="hover:underline">Home</a>
        </li>
        

        
        
        
          
          
          

          <li>
            <span class="mx-2">/</span>
            
              <a href="/query-api/" class="hover:underline capitalize">
                ElasticGraph Query API
              </a>
            
          </li>
        
          
          
          

          <li>
            <span class="mx-2">/</span>
            
              <a href="/query-api/filtering/" class="hover:underline capitalize">
                Filtering
              </a>
            
          </li>
        
          
          
          

          <li>
            <span class="mx-2">/</span>
            
              Conjunctions
            
          </li>
        
      </ol>
    </nav>
  </div>
</nav>


  <main class="flex-grow">
    <div class="container mx-auto px-4 py-8 lg:py-20">
      <article class="prose dark:prose-invert lg:prose-xl">
        <h2>ElasticGraph Query API: Filter Conjunctions</h2>

        <p>ElasticGraph supports two conjunction predicates:</p>

<dl>
  <dt><a href="/query-api/filtering/conjunctions/"><code class="language-plaintext highlighter-rouge">allOf</code></a></dt>
  <dd>Matches records where all of the provided sub-filters evaluate to true.
This works just like an <code class="language-plaintext highlighter-rouge">AND</code> operator in SQL.

    <p>Note: multiple filters are automatically ANDed together. This is only needed when you have multiple
filters that can’t be provided on a single filter input because of collisions between key names.
For example, if you want to provide multiple <code class="language-plaintext highlighter-rouge">anySatisfy: ...</code> filters, you could do <code class="language-plaintext highlighter-rouge">allOf: [{anySatisfy: ...}, {anySatisfy: ...}]</code>.</p>

    <p>Will be ignored when <code class="language-plaintext highlighter-rouge">null</code> or an empty list is passed.</p>
  </dd>
  <dt><a href="/query-api/filtering/conjunctions/"><code class="language-plaintext highlighter-rouge">anyOf</code></a></dt>
  <dd>Matches records where any of the provided sub-filters evaluate to true.
This works just like an <code class="language-plaintext highlighter-rouge">OR</code> operator in SQL.

    <p>Will be ignored when <code class="language-plaintext highlighter-rouge">null</code> is passed. When an empty list is passed, will
cause this part of the filter to match no documents.</p>
  </dd>
</dl>

<p>By default, multiple filters are ANDed together. For example, this query finds artists
formed after the year 2000 with “accordion” in their bio:</p>

<figure class="highlight"><pre><code class="language-graphql" data-lang="graphql"><span class="k">query</span><span class="w"> </span><span class="n">FindRecentAccordionArtists</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">artists</span><span class="p">(</span><span class="n">filter</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">bio</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">yearFormed</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">gt</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="p">}</span><span class="w">
      </span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">matchesQuery</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s2">"accordion"</span><span class="p">}}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">})</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">nodes</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">name</span><span class="w">
      </span><span class="n">bio</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">yearFormed</span><span class="w">
        </span><span class="n">description</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<h3 id="oring-subfilters-with-anyof">ORing subfilters with <code class="language-plaintext highlighter-rouge">anyOf</code></h3>

<p>To instead find artists formed after the year 2000 OR with “accordion” in their bio, you
can wrap the sub-filters in an <code class="language-plaintext highlighter-rouge">anyOf</code>:</p>

<figure class="highlight"><pre><code class="language-graphql" data-lang="graphql"><span class="k">query</span><span class="w"> </span><span class="n">FindRecentOrAccordionArtists</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">artists</span><span class="p">(</span><span class="n">filter</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">bio</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">anyOf</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="n">yearFormed</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">gt</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="p">}}</span><span class="w">
        </span><span class="p">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">matchesQuery</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s2">"accordion"</span><span class="p">}}}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">})</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">nodes</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">name</span><span class="w">
      </span><span class="n">bio</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">yearFormed</span><span class="w">
        </span><span class="n">description</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">anyOf</code> is available at all levels of the filtering structure so that you can OR
sub-filters anywhere you like.</p>

<h3 id="anding-subfilters-with-allof">ANDing subfilters with <code class="language-plaintext highlighter-rouge">allOf</code></h3>

<p><code class="language-plaintext highlighter-rouge">allOf</code> is rarely needed since multiple filters are ANDed together by default. But it can
come in handy when you’d otherwise have a duplicate key collision on a filter input. One
case where this comes in handy is when using <code class="language-plaintext highlighter-rouge">anySatisfy</code> to <a href="/query-api/filtering/list/">filter on a
list</a>. Consider this query:</p>

<figure class="highlight"><pre><code class="language-graphql" data-lang="graphql"><span class="k">query</span><span class="w"> </span><span class="n">ArtistsWithPlatinum90sAlbum</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">artists</span><span class="p">(</span><span class="n">filter</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">albums</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">anySatisfy</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">soldUnits</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">gte</span><span class="p">:</span><span class="w"> </span><span class="mi">1000000</span><span class="p">}</span><span class="w">
        </span><span class="n">releasedOn</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">gte</span><span class="p">:</span><span class="w"> </span><span class="s2">"1990-01-01"</span><span class="p">,</span><span class="w"> </span><span class="n">lt</span><span class="p">:</span><span class="w"> </span><span class="s2">"2000-01-01"</span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">})</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">nodes</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">name</span><span class="w">
      </span><span class="n">albums</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">name</span><span class="w">
        </span><span class="n">releasedOn</span><span class="w">
        </span><span class="n">soldUnits</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>This query finds artists who released an album in the 90’s that sold more than million copies.
If you wanted to broaden the query to find artists with at least one 90’s album and at least one
platinum-selling album–without requiring it to be the same album–you could do this:</p>

<figure class="highlight"><pre><code class="language-graphql" data-lang="graphql"><span class="k">query</span><span class="w"> </span><span class="n">ArtistsWith90sAlbumAndPlatinumAlbum</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">artists</span><span class="p">(</span><span class="n">filter</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">albums</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">allOf</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="n">anySatisfy</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">soldUnits</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">gte</span><span class="p">:</span><span class="w"> </span><span class="mi">1000000</span><span class="p">}}}</span><span class="w">
        </span><span class="p">{</span><span class="n">anySatisfy</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">releasedOn</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">gte</span><span class="p">:</span><span class="w"> </span><span class="s2">"1990-01-01"</span><span class="p">,</span><span class="w"> </span><span class="n">lt</span><span class="p">:</span><span class="w"> </span><span class="s2">"2000-01-01"</span><span class="p">}}}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">})</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">nodes</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">name</span><span class="w">
      </span><span class="n">albums</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">name</span><span class="w">
        </span><span class="n">releasedOn</span><span class="w">
        </span><span class="n">soldUnits</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>GraphQL input objects don’t allow duplicate keys, so
<code class="language-plaintext highlighter-rouge">albums: {anySatisfy: {...}, anySatisfy: {...}}</code> isn’t supported, but <code class="language-plaintext highlighter-rouge">allOf</code>
enables this use case.</p>

<h3 id="warning-always-pass-a-list">Warning: Always Pass a List</h3>

<p>When using <code class="language-plaintext highlighter-rouge">allOf</code> or <code class="language-plaintext highlighter-rouge">anyOf</code>, be sure to pass the sub-filters as a list. If you instead
pass them as an object, it won’t work as expected. Consider this query:</p>

<figure class="highlight"><pre><code class="language-graphql" data-lang="graphql"><span class="k">query</span><span class="w"> </span><span class="n">AnyOfGotcha</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">artists</span><span class="p">(</span><span class="n">filter</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">bio</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">anyOf</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">yearFormed</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">gt</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="p">}</span><span class="w">
        </span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">matchesQuery</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s2">"accordion"</span><span class="p">}}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">})</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">nodes</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">name</span><span class="w">
      </span><span class="n">bio</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">yearFormed</span><span class="w">
        </span><span class="n">description</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>While this query will return results, it doesn’t behave as it appears. The GraphQL
spec mandates that list inputs <a href="https://spec.graphql.org/October2021/#sec-List.Input-Coercion">coerce non-list values into a list of one
value</a>. In this case,
that means that the <code class="language-plaintext highlighter-rouge">anyOf</code> expression is coerced into this:</p>

<figure class="highlight"><pre><code class="language-graphql" data-lang="graphql"><span class="k">query</span><span class="w"> </span><span class="n">AnyOfGotcha</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">artists</span><span class="p">(</span><span class="n">filter</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">bio</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">anyOf</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
        </span><span class="n">yearFormed</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">gt</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="p">}</span><span class="w">
        </span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">matchesQuery</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s2">"accordion"</span><span class="p">}}</span><span class="w">
      </span><span class="p">}]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">})</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c"># ...</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>Using <code class="language-plaintext highlighter-rouge">anyOf</code> with only a single sub-expression, as we have here, doesn’t do anything;
the query is equivalent to:</p>

<figure class="highlight"><pre><code class="language-graphql" data-lang="graphql"><span class="k">query</span><span class="w"> </span><span class="n">AnyOfGotcha</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">artists</span><span class="p">(</span><span class="n">filter</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">bio</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">yearFormed</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">gt</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="p">}</span><span class="w">
      </span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">matchesQuery</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s2">"accordion"</span><span class="p">}}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">})</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c"># ...</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure>


      </article>
    </div>
  </main>

  <!-- Footer -->
<footer class="bg-gray-200 dark:bg-gray-900 py-8">
  <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-2 gap-8">
    <div>
      <h3 class="text-lg font-bold text-gray-900 dark:text-gray-100 mb-4">
        ElasticGraph
      </h3>
      <p class="text-gray-700 dark:text-gray-300">
        ElasticGraph is an open-source framework for indexing, searching,
        grouping, and aggregating data. Join our community and contribute on
        <a href="https://github.com/block/elasticgraph" class="text-blue-600 dark:text-blue-400 hover:underline">GitHub</a>.
      </p>
    </div>
  </div>
</footer>

</body>

</html>
