<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: ElasticGraph::SchemaDefinition::Indexing::DerivedIndexedType
  
    &mdash; Documentation by YARD 0.9.37
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "ElasticGraph::SchemaDefinition::Indexing::DerivedIndexedType";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (D)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../ElasticGraph.html" title="ElasticGraph (module)">ElasticGraph</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../SchemaDefinition.html" title="ElasticGraph::SchemaDefinition (module)">SchemaDefinition</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Indexing.html" title="ElasticGraph::SchemaDefinition::Indexing (module)">Indexing</a></span></span>
     &raquo; 
    <span class="title">DerivedIndexedType</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: ElasticGraph::SchemaDefinition::Indexing::DerivedIndexedType
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ElasticGraph::SchemaDefinition::Indexing::DerivedIndexedType</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>elasticgraph-schema_definition/lib/elastic_graph/schema_definition/indexing/derived_indexed_type.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Used to configure the derivation of a derived indexed type from a source type.
This type is yielded from <span class='object_link'><a href="../Mixins/HasIndices.html#derive_indexed_type_fields-instance_method" title="ElasticGraph::SchemaDefinition::Mixins::HasIndices#derive_indexed_type_fields (method)">Mixins::HasIndices#derive_indexed_type_fields</a></span>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'><p>Derive a <code>Course</code> type from <code>StudentCourseEnrollment</code> events</p>
</div></h5>
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="../../../ElasticGraph.html" title="ElasticGraph (module)">ElasticGraph</a></span></span><span class='period'>.</span><span class='id identifier rubyid_define_schema'><span class='object_link'><a href="../../../ElasticGraph.html#define_schema-class_method" title="ElasticGraph.define_schema (method)">define_schema</a></span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_schema'>schema</span><span class='op'>|</span>
  <span class='comment'># `StudentCourseEnrollment` is a directly indexed type.
</span>  <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_object_type'>object_type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>StudentCourseEnrollment</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseId</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseName</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>String</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>studentName</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>String</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseStartDate</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Date</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>student_course_enrollments</span><span class='tstring_end'>&quot;</span></span>

    <span class='comment'># Here we define how the `Course` indexed type  is derived when we index `StudentCourseEnrollment` events.
</span>    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_derive_indexed_type_fields'>derive_indexed_type_fields</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Course</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>from_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseId</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_derive'>derive</span><span class='op'>|</span>
      <span class='comment'># `derive` is an instance of `DerivedIndexedType`.
</span>      <span class='id identifier rubyid_derive'>derive</span><span class='period'>.</span><span class='id identifier rubyid_immutable_value'>immutable_value</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>from:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseName</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_derive'>derive</span><span class='period'>.</span><span class='id identifier rubyid_append_only_set'>append_only_set</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>students</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>from:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>studentName</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_derive'>derive</span><span class='period'>.</span><span class='id identifier rubyid_min_value'>min_value</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>firstOfferedDate</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>from:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseStartDate</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_derive'>derive</span><span class='period'>.</span><span class='id identifier rubyid_max_value'>max_value</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mostRecentlyOfferedDate</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>from:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseStartDate</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># `Course` is an indexed type that is derived entirely from `StudentCourseEnrollment` events.
</span>  <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_object_type'>object_type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Course</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>String</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>students</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[String!]!</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>firstOfferedDate</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Date</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mostRecentlyOfferedDate</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Date</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courses</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>


</div>



  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#fields-instance_method" title="#fields (instance method)">#<strong>fields</strong>  &#x21d2; Array&lt;DerivedFields::AppendOnlySet, DerivedFields::ImmutableValue, DerivedFields::MinOrMaxValue&gt; </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Derived field definitions.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#id_source-instance_method" title="#id_source (instance method)">#<strong>id_source</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Path to field on the source type used as <code>id</code> on the derived type.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#rollover_timestamp_value_source-instance_method" title="#rollover_timestamp_value_source (instance method)">#<strong>rollover_timestamp_value_source</strong>  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Path to field on the source type used as the timestamp field for rollover.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#routing_value_source-instance_method" title="#routing_value_source (instance method)">#<strong>routing_value_source</strong>  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Path to field on the source type used for shard routing.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#source_type-instance_method" title="#source_type (instance method)">#<strong>source_type</strong>  &#x21d2; SchemaElements::ObjectType </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The type used as a source for this derive type.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#append_only_set-instance_method" title="#append_only_set (instance method)">#<strong>append_only_set</strong>(field_name, from:)  &#x21d2; DerivedIndexedType::AppendOnlySet </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Configures <code>field_name</code> (on the derived indexing type) to contain the set union of all values from the <code>from</code> field on the source type.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#immutable_value-instance_method" title="#immutable_value (instance method)">#<strong>immutable_value</strong>(field_name, from:, nullable: true, can_change_from_null: false)  &#x21d2; DerivedFields::ImmutableValue </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Configures <code>field_name</code> (on the derived indexing type) to contain a single immutable value from the <code>from</code> field on the source type.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(source_type:, destination_type_ref:, id_source:, routing_value_source:, rollover_timestamp_value_source:) {|DerivedIndexedType| ... } &#x21d2; DerivedIndexedType </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'><p>A new instance of DerivedIndexedType.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#max_value-instance_method" title="#max_value (instance method)">#<strong>max_value</strong>(field_name, from:)  &#x21d2; DerivedIndexedType::MinOrMaxValue </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Configures <code>field_name</code> (on the derived indexing type) to contain the maximum of all values from the <code>from</code> field on the source type.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#min_value-instance_method" title="#min_value (instance method)">#<strong>min_value</strong>(field_name, from:)  &#x21d2; DerivedIndexedType::MinOrMaxValue </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Configures <code>field_name</code> (on the derived indexing type) to contain the minimum of all values from the <code>from</code> field on the source type.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#painless_script-instance_method" title="#painless_script (instance method)">#<strong>painless_script</strong>  &#x21d2; Scripting::Script </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'><p>Painless script that will maintain the derived fields.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#runtime_metadata_for_source_type-instance_method" title="#runtime_metadata_for_source_type (instance method)">#<strong>runtime_metadata_for_source_type</strong>  &#x21d2; SchemaArtifacts::RuntimeMetadata::UpdateTarget </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'><p>Runtime metadata for the source type.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(source_type:, destination_type_ref:, id_source:, routing_value_source:, rollover_timestamp_value_source:) {|DerivedIndexedType| ... } &#x21d2; <tt><span class='object_link'><a href="" title="ElasticGraph::SchemaDefinition::Indexing::DerivedIndexedType (class)">DerivedIndexedType</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>
<p>Returns a new instance of DerivedIndexedType.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>source_type</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../SchemaElements/ObjectType.html" title="ElasticGraph::SchemaDefinition::SchemaElements::ObjectType (class)">SchemaElements::ObjectType</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the type used as a source for this derive type</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>destination_type_ref</span>
      
      
        <span class='type'>(<tt><span class='object_link'>SchemaElements::TypeReference</span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the derived type</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>id_source</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>path to field on the source type used as <code>id</code> on the derived type</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>routing_value_source</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>path to field on the source type used for shard routing</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>rollover_timestamp_value_source</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>path to field on the source type used as the timestamp field for rollover</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="ElasticGraph::SchemaDefinition::Indexing::DerivedIndexedType (class)">DerivedIndexedType</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the <code>DerivedIndexedType</code> instance</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'elasticgraph-schema_definition/lib/elastic_graph/schema_definition/indexing/derived_indexed_type.rb', line 82</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span>
  <span class='label'>source_type:</span><span class='comma'>,</span>
  <span class='label'>destination_type_ref:</span><span class='comma'>,</span>
  <span class='label'>id_source:</span><span class='comma'>,</span>
  <span class='label'>routing_value_source:</span><span class='comma'>,</span>
  <span class='label'>rollover_timestamp_value_source:</span>
<span class='rparen'>)</span>
  <span class='id identifier rubyid_fields'>fields</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='comment'># : ::Array[_DerivedField]
</span>  <span class='kw'>super</span><span class='lparen'>(</span>
    <span class='label'>source_type:</span> <span class='id identifier rubyid_source_type'>source_type</span><span class='comma'>,</span>
    <span class='label'>destination_type_ref:</span> <span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='comma'>,</span>
    <span class='label'>id_source:</span> <span class='id identifier rubyid_id_source'>id_source</span><span class='comma'>,</span>
    <span class='label'>routing_value_source:</span> <span class='id identifier rubyid_routing_value_source'>routing_value_source</span><span class='comma'>,</span>
    <span class='label'>rollover_timestamp_value_source:</span> <span class='id identifier rubyid_rollover_timestamp_value_source'>rollover_timestamp_value_source</span><span class='comma'>,</span>
    <span class='label'>fields:</span> <span class='id identifier rubyid_fields'>fields</span>
  <span class='rparen'>)</span>
  <span class='kw'>yield</span> <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="fields=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="fields-instance_method">
  
    #<strong>fields</strong>  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="DerivedFields/AppendOnlySet.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::AppendOnlySet (class)">DerivedFields::AppendOnlySet</a></span>, <span class='object_link'><a href="DerivedFields/ImmutableValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::ImmutableValue (class)">DerivedFields::ImmutableValue</a></span>, <span class='object_link'><a href="DerivedFields/MinOrMaxValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::MinOrMaxValue (class)">DerivedFields::MinOrMaxValue</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns derived field definitions.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="DerivedFields/AppendOnlySet.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::AppendOnlySet (class)">DerivedFields::AppendOnlySet</a></span>, <span class='object_link'><a href="DerivedFields/ImmutableValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::ImmutableValue (class)">DerivedFields::ImmutableValue</a></span>, <span class='object_link'><a href="DerivedFields/MinOrMaxValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::MinOrMaxValue (class)">DerivedFields::MinOrMaxValue</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>derived field definitions</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'elasticgraph-schema_definition/lib/elastic_graph/schema_definition/indexing/derived_indexed_type.rb', line 67</span>

<span class='kw'>class</span> <span class='const'><span class='object_link'><a href="" title="ElasticGraph::SchemaDefinition::Indexing::DerivedIndexedType (class)">DerivedIndexedType</a></span></span> <span class='op'>&lt;</span> <span class='op'>::</span><span class='const'>Struct</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
  <span class='symbol'>:source_type</span><span class='comma'>,</span>
  <span class='symbol'>:destination_type_ref</span><span class='comma'>,</span>
  <span class='symbol'>:id_source</span><span class='comma'>,</span>
  <span class='symbol'>:routing_value_source</span><span class='comma'>,</span>
  <span class='symbol'>:rollover_timestamp_value_source</span><span class='comma'>,</span>
  <span class='symbol'>:fields</span>
<span class='rparen'>)</span>
  <span class='comment'># @param source_type [SchemaElements::ObjectType] the type used as a source for this derive type
</span>  <span class='comment'># @param destination_type_ref [SchemaElements::TypeReference] the derived type
</span>  <span class='comment'># @param id_source [String] path to field on the source type used as `id` on the derived type
</span>  <span class='comment'># @param routing_value_source [String, nil] path to field on the source type used for shard routing
</span>  <span class='comment'># @param rollover_timestamp_value_source [String, nil] path to field on the source type used as the timestamp field for rollover
</span>  <span class='comment'># @yield [DerivedIndexedType] the `DerivedIndexedType` instance
</span>  <span class='comment'># @api private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span>
    <span class='label'>source_type:</span><span class='comma'>,</span>
    <span class='label'>destination_type_ref:</span><span class='comma'>,</span>
    <span class='label'>id_source:</span><span class='comma'>,</span>
    <span class='label'>routing_value_source:</span><span class='comma'>,</span>
    <span class='label'>rollover_timestamp_value_source:</span>
  <span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='comment'># : ::Array[_DerivedField]
</span>    <span class='kw'>super</span><span class='lparen'>(</span>
      <span class='label'>source_type:</span> <span class='id identifier rubyid_source_type'>source_type</span><span class='comma'>,</span>
      <span class='label'>destination_type_ref:</span> <span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='comma'>,</span>
      <span class='label'>id_source:</span> <span class='id identifier rubyid_id_source'>id_source</span><span class='comma'>,</span>
      <span class='label'>routing_value_source:</span> <span class='id identifier rubyid_routing_value_source'>routing_value_source</span><span class='comma'>,</span>
      <span class='label'>rollover_timestamp_value_source:</span> <span class='id identifier rubyid_rollover_timestamp_value_source'>rollover_timestamp_value_source</span><span class='comma'>,</span>
      <span class='label'>fields:</span> <span class='id identifier rubyid_fields'>fields</span>
    <span class='rparen'>)</span>
    <span class='kw'>yield</span> <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain the set union of all values from
</span>  <span class='comment'># the `from` field on the source type. Values are only ever appended to the set, so the field will
</span>  <span class='comment'># act as an append-only set.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived set
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @return [DerivedIndexedType::AppendOnlySet]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;studentName&quot;, &quot;String&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.append_only_set &quot;students&quot;, from: &quot;studentName&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;students&quot;, &quot;[String!]!&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_append_only_set'>append_only_set</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/AppendOnlySet.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::AppendOnlySet (class)">AppendOnlySet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain a single immutable value from the
</span>  <span class='comment'># `from` field on the source type. Immutability is enforced by triggering an indexing failure with a
</span>  <span class='comment'># clear error if any event&#39;s source value is different from the value already indexed on this field.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived value
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @param nullable [Boolean] whether the field is allowed to be set to `null`. When set to false, events
</span>  <span class='comment'>#   that contain a `null` value in the `from` field will be rejected instead of setting the fieldâ€™s value
</span>  <span class='comment'>#   to `null`.
</span>  <span class='comment'># @param can_change_from_null [Boolean] whether a one-time mutation of the field value is allowed from
</span>  <span class='comment'>#   `null` to a non-`null` value. This can be useful when dealing with a field that may not have a value
</span>  <span class='comment'>#   on all source events. For example, if the source field was not initially part of the schema of your
</span>  <span class='comment'>#   source dataset, you may have old records that lack a value for this field. When set, this option
</span>  <span class='comment'>#   allows a one-time mutation of the field value from `null` to a non-`null` value. Once set to a
</span>  <span class='comment'>#   non-`null` value, any additional `null` values that are encountered will be ignored (ensuring that
</span>  <span class='comment'>#   the indexed data converges on the same state regardless of the order the events are ingested in).
</span>  <span class='comment'>#   Note: this option cannot be enabled when `nullable: false` has been set.
</span>  <span class='comment'># @return [DerivedFields::ImmutableValue]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseName&quot;, &quot;String&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.immutable_value &quot;name&quot;, from: &quot;courseName&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;name&quot;, &quot;String&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_immutable_value'>immutable_value</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='comma'>,</span> <span class='label'>nullable:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>can_change_from_null:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_nullable'>nullable</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_can_change_from_null'>can_change_from_null</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Errors</span><span class='op'>::</span><span class='const'>SchemaError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`can_change_from_null: true` is not allowed with `nullable: false` (as there would be no `null` values to change from).</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/ImmutableValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::ImmutableValue (class)">ImmutableValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='label'>destination_field:</span> <span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span>
      <span class='label'>source_field:</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span>
      <span class='label'>nullable:</span> <span class='id identifier rubyid_nullable'>nullable</span><span class='comma'>,</span>
      <span class='label'>can_change_from_null:</span> <span class='id identifier rubyid_can_change_from_null'>can_change_from_null</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain the minimum of all values from the `from`
</span>  <span class='comment'># field on the source type.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived value
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @return [DerivedIndexedType::MinOrMaxValue]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseStartDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.min_value &quot;firstOfferedDate&quot;, from: &quot;courseStartDate&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;firstOfferedDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_min_value'>min_value</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/MinOrMaxValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::MinOrMaxValue (class)">MinOrMaxValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='symbol'>:min</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain the maximum of all values from the `from`
</span>  <span class='comment'># field on the source type.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived value
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @return [DerivedIndexedType::MinOrMaxValue]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseStartDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.max_value &quot;mostRecentlyOfferedDate&quot;, from: &quot;courseStartDate&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;mostRecentlyOfferedDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_max_value'>max_value</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/MinOrMaxValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::MinOrMaxValue (class)">MinOrMaxValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='symbol'>:max</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># @return [Scripting::Script] Painless script that will maintain the derived fields
</span>  <span class='comment'># @api private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_painless_script'>painless_script</span>
    <span class='const'>Scripting</span><span class='op'>::</span><span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='label'>source:</span> <span class='id identifier rubyid_generate_script'>generate_script</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='comma'>,</span>
      <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='embexpr_end'>}</span><span class='tstring_content'>_from_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_type'>source_type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>language:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>painless</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>context:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>update</span><span class='tstring_end'>&quot;</span></span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># @return [SchemaArtifacts::RuntimeMetadata::UpdateTarget] runtime metadata for the source type
</span>  <span class='comment'># @api private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_runtime_metadata_for_source_type'>runtime_metadata_for_source_type</span>
    <span class='const'>SchemaArtifacts</span><span class='op'>::</span><span class='const'>RuntimeMetadata</span><span class='op'>::</span><span class='const'>UpdateTarget</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='label'>type:</span> <span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
      <span class='label'>relationship:</span> <span class='kw'>nil</span><span class='comma'>,</span>
      <span class='label'>script_id:</span> <span class='id identifier rubyid_painless_script'>painless_script</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
      <span class='label'>id_source:</span> <span class='id identifier rubyid_id_source'>id_source</span><span class='comma'>,</span>
      <span class='label'>routing_value_source:</span> <span class='id identifier rubyid_routing_value_source'>routing_value_source</span><span class='comma'>,</span>
      <span class='label'>rollover_timestamp_value_source:</span> <span class='id identifier rubyid_rollover_timestamp_value_source'>rollover_timestamp_value_source</span><span class='comma'>,</span>
      <span class='label'>metadata_params:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span>
      <span class='label'>data_params:</span> <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:source_field</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
        <span class='lbracket'>[</span><span class='id identifier rubyid_f'>f</span><span class='comma'>,</span> <span class='const'>SchemaArtifacts</span><span class='op'>::</span><span class='const'>RuntimeMetadata</span><span class='op'>::</span><span class='const'>DynamicParam</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>source_path:</span> <span class='id identifier rubyid_f'>f</span><span class='comma'>,</span> <span class='label'>cardinality:</span> <span class='symbol'>:many</span><span class='rparen'>)</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_generate_script'>generate_script</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Errors</span><span class='op'>::</span><span class='const'>SchemaError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`derive_indexed_type_fields` definition for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='embexpr_end'>}</span><span class='tstring_content'> (from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_type'>source_type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>) </span><span class='tstring_end'>&quot;</span></span> \
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>has no derived field definitions.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_sorted_fields'>sorted_fields</span> <span class='op'>=</span> <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:destination_field</span><span class='rparen'>)</span>

    <span class='comment'># We use `uniq` here to avoid re-doing the same setup multiple times, since multiple fields can sometimes
</span>    <span class='comment'># need the same setup (such as initializing a common parent field to an empty map).
</span>    <span class='id identifier rubyid_function_defs'>function_defs</span> <span class='op'>=</span> <span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:function_definitions</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:strip</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>

    <span class='id identifier rubyid_setup_statements'>setup_statements</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>STATIC_SETUP_STATEMENTS</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:setup_statements</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:strip</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_apply_update_statements'>apply_update_statements</span> <span class='op'>=</span> <span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_apply_update_statement'>apply_update_statement</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span> <span class='rbrace'>}</span>

    <span class='comment'># Note: comments in the script are effectively &quot;free&quot; since:
</span>    <span class='comment'>#
</span>    <span class='comment'>#   - The compiler will strip them out.
</span>    <span class='comment'>#   - We only send the script to the datastore once (when configuring the cluster), and later
</span>    <span class='comment'>#     reference it only by id--so we don&#39;t pay for the larger payload on each indexing request.
</span>    <span class='heredoc_beg'>&lt;&lt;~EOS</span>
<span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_function_defs'>function_defs</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>
</span><span class='tstring_content'>
</span><span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_setup_statements'>setup_statements</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>
</span><span class='tstring_content'>
</span><span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_apply_update_statements'>apply_update_statements</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>
</span><span class='tstring_content'>
</span><span class='tstring_content'>      if (!</span><span class='embexpr_beg'>#{</span><span class='const'>SCRIPT_ERRORS_VAR</span><span class='embexpr_end'>}</span><span class='tstring_content'>.isEmpty()) {
</span><span class='tstring_content'>        throw new IllegalArgumentException(&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>DERIVED_INDEX_FAILURE_MESSAGE_PREAMBLE</span><span class='embexpr_end'>}</span><span class='tstring_content'>: &quot; + </span><span class='embexpr_beg'>#{</span><span class='const'>SCRIPT_ERRORS_VAR</span><span class='embexpr_end'>}</span><span class='tstring_content'>.join(&quot; &quot;));
</span><span class='tstring_content'>      }
</span><span class='tstring_content'>
</span><span class='tstring_content'>      // For records with no new values to index, only skip the update if the document itself doesn&#39;t already exist.
</span><span class='tstring_content'>      // Otherwise create an (empty) document to reflect the fact that the id has been seen.
</span><span class='tstring_content'>      if (ctx._source.id != null &amp;&amp; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_was_noop_variable'>was_noop_variable</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> &amp;&amp; </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
</span><span class='tstring_content'>        ctx.op = &#39;none&#39;;
</span><span class='tstring_content'>      } else {
</span><span class='tstring_content'>        // Here we set `_source.id` because if we don&#39;t, it&#39;ll never be set, making these docs subtly
</span><span class='tstring_content'>        // different from docs indexed the normal way.
</span><span class='tstring_content'>        //
</span><span class='tstring_content'>        // Note also that we MUST use `params.id` instead of `ctx._id`. The latter works on an update
</span><span class='tstring_content'>        // of an existing document, but is unavailable when we are inserting the document for the first time.
</span><span class='tstring_content'>        ctx._source.id = params.id;
</span><span class='tstring_content'>      }
</span><span class='heredoc_end'>    EOS
</span>  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_apply_update_statement'>apply_update_statement</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>boolean </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_was_noop_variable'>was_noop_variable</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> = !</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_apply_operation_returning_update_status'>apply_operation_returning_update_status</span><span class='embexpr_end'>}</span><span class='tstring_content'>;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_was_noop_variable'>was_noop_variable</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_destination_field'>destination_field</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>__</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>_was_noop</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='const'>SCRIPT_ERRORS_VAR</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>scriptErrors</span><span class='tstring_end'>&quot;</span></span>

  <span class='const'>STATIC_SETUP_STATEMENTS</span> <span class='op'>=</span> <span class='heredoc_beg'>&lt;&lt;~EOS</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>
<span class='tstring_content'>    Map data = params.data;
</span><span class='tstring_content'>    // A variable to accumulate script errors so that we can surface _all_ issues and not just the first.
</span><span class='tstring_content'>    List </span><span class='embexpr_beg'>#{</span><span class='const'>SCRIPT_ERRORS_VAR</span><span class='embexpr_end'>}</span><span class='tstring_content'> = new ArrayList();
</span><span class='heredoc_end'>  EOS
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="id_source=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="id_source-instance_method">
  
    #<strong>id_source</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns path to field on the source type used as <code>id</code> on the derived type.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>path to field on the source type used as <code>id</code> on the derived type</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'elasticgraph-schema_definition/lib/elastic_graph/schema_definition/indexing/derived_indexed_type.rb', line 67</span>

<span class='kw'>class</span> <span class='const'><span class='object_link'><a href="" title="ElasticGraph::SchemaDefinition::Indexing::DerivedIndexedType (class)">DerivedIndexedType</a></span></span> <span class='op'>&lt;</span> <span class='op'>::</span><span class='const'>Struct</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
  <span class='symbol'>:source_type</span><span class='comma'>,</span>
  <span class='symbol'>:destination_type_ref</span><span class='comma'>,</span>
  <span class='symbol'>:id_source</span><span class='comma'>,</span>
  <span class='symbol'>:routing_value_source</span><span class='comma'>,</span>
  <span class='symbol'>:rollover_timestamp_value_source</span><span class='comma'>,</span>
  <span class='symbol'>:fields</span>
<span class='rparen'>)</span>
  <span class='comment'># @param source_type [SchemaElements::ObjectType] the type used as a source for this derive type
</span>  <span class='comment'># @param destination_type_ref [SchemaElements::TypeReference] the derived type
</span>  <span class='comment'># @param id_source [String] path to field on the source type used as `id` on the derived type
</span>  <span class='comment'># @param routing_value_source [String, nil] path to field on the source type used for shard routing
</span>  <span class='comment'># @param rollover_timestamp_value_source [String, nil] path to field on the source type used as the timestamp field for rollover
</span>  <span class='comment'># @yield [DerivedIndexedType] the `DerivedIndexedType` instance
</span>  <span class='comment'># @api private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span>
    <span class='label'>source_type:</span><span class='comma'>,</span>
    <span class='label'>destination_type_ref:</span><span class='comma'>,</span>
    <span class='label'>id_source:</span><span class='comma'>,</span>
    <span class='label'>routing_value_source:</span><span class='comma'>,</span>
    <span class='label'>rollover_timestamp_value_source:</span>
  <span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='comment'># : ::Array[_DerivedField]
</span>    <span class='kw'>super</span><span class='lparen'>(</span>
      <span class='label'>source_type:</span> <span class='id identifier rubyid_source_type'>source_type</span><span class='comma'>,</span>
      <span class='label'>destination_type_ref:</span> <span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='comma'>,</span>
      <span class='label'>id_source:</span> <span class='id identifier rubyid_id_source'>id_source</span><span class='comma'>,</span>
      <span class='label'>routing_value_source:</span> <span class='id identifier rubyid_routing_value_source'>routing_value_source</span><span class='comma'>,</span>
      <span class='label'>rollover_timestamp_value_source:</span> <span class='id identifier rubyid_rollover_timestamp_value_source'>rollover_timestamp_value_source</span><span class='comma'>,</span>
      <span class='label'>fields:</span> <span class='id identifier rubyid_fields'>fields</span>
    <span class='rparen'>)</span>
    <span class='kw'>yield</span> <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain the set union of all values from
</span>  <span class='comment'># the `from` field on the source type. Values are only ever appended to the set, so the field will
</span>  <span class='comment'># act as an append-only set.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived set
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @return [DerivedIndexedType::AppendOnlySet]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;studentName&quot;, &quot;String&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.append_only_set &quot;students&quot;, from: &quot;studentName&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;students&quot;, &quot;[String!]!&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_append_only_set'>append_only_set</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/AppendOnlySet.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::AppendOnlySet (class)">AppendOnlySet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain a single immutable value from the
</span>  <span class='comment'># `from` field on the source type. Immutability is enforced by triggering an indexing failure with a
</span>  <span class='comment'># clear error if any event&#39;s source value is different from the value already indexed on this field.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived value
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @param nullable [Boolean] whether the field is allowed to be set to `null`. When set to false, events
</span>  <span class='comment'>#   that contain a `null` value in the `from` field will be rejected instead of setting the fieldâ€™s value
</span>  <span class='comment'>#   to `null`.
</span>  <span class='comment'># @param can_change_from_null [Boolean] whether a one-time mutation of the field value is allowed from
</span>  <span class='comment'>#   `null` to a non-`null` value. This can be useful when dealing with a field that may not have a value
</span>  <span class='comment'>#   on all source events. For example, if the source field was not initially part of the schema of your
</span>  <span class='comment'>#   source dataset, you may have old records that lack a value for this field. When set, this option
</span>  <span class='comment'>#   allows a one-time mutation of the field value from `null` to a non-`null` value. Once set to a
</span>  <span class='comment'>#   non-`null` value, any additional `null` values that are encountered will be ignored (ensuring that
</span>  <span class='comment'>#   the indexed data converges on the same state regardless of the order the events are ingested in).
</span>  <span class='comment'>#   Note: this option cannot be enabled when `nullable: false` has been set.
</span>  <span class='comment'># @return [DerivedFields::ImmutableValue]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseName&quot;, &quot;String&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.immutable_value &quot;name&quot;, from: &quot;courseName&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;name&quot;, &quot;String&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_immutable_value'>immutable_value</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='comma'>,</span> <span class='label'>nullable:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>can_change_from_null:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_nullable'>nullable</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_can_change_from_null'>can_change_from_null</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Errors</span><span class='op'>::</span><span class='const'>SchemaError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`can_change_from_null: true` is not allowed with `nullable: false` (as there would be no `null` values to change from).</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/ImmutableValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::ImmutableValue (class)">ImmutableValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='label'>destination_field:</span> <span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span>
      <span class='label'>source_field:</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span>
      <span class='label'>nullable:</span> <span class='id identifier rubyid_nullable'>nullable</span><span class='comma'>,</span>
      <span class='label'>can_change_from_null:</span> <span class='id identifier rubyid_can_change_from_null'>can_change_from_null</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain the minimum of all values from the `from`
</span>  <span class='comment'># field on the source type.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived value
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @return [DerivedIndexedType::MinOrMaxValue]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseStartDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.min_value &quot;firstOfferedDate&quot;, from: &quot;courseStartDate&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;firstOfferedDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_min_value'>min_value</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/MinOrMaxValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::MinOrMaxValue (class)">MinOrMaxValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='symbol'>:min</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain the maximum of all values from the `from`
</span>  <span class='comment'># field on the source type.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived value
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @return [DerivedIndexedType::MinOrMaxValue]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseStartDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.max_value &quot;mostRecentlyOfferedDate&quot;, from: &quot;courseStartDate&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;mostRecentlyOfferedDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_max_value'>max_value</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/MinOrMaxValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::MinOrMaxValue (class)">MinOrMaxValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='symbol'>:max</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># @return [Scripting::Script] Painless script that will maintain the derived fields
</span>  <span class='comment'># @api private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_painless_script'>painless_script</span>
    <span class='const'>Scripting</span><span class='op'>::</span><span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='label'>source:</span> <span class='id identifier rubyid_generate_script'>generate_script</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='comma'>,</span>
      <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='embexpr_end'>}</span><span class='tstring_content'>_from_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_type'>source_type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>language:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>painless</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>context:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>update</span><span class='tstring_end'>&quot;</span></span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># @return [SchemaArtifacts::RuntimeMetadata::UpdateTarget] runtime metadata for the source type
</span>  <span class='comment'># @api private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_runtime_metadata_for_source_type'>runtime_metadata_for_source_type</span>
    <span class='const'>SchemaArtifacts</span><span class='op'>::</span><span class='const'>RuntimeMetadata</span><span class='op'>::</span><span class='const'>UpdateTarget</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='label'>type:</span> <span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
      <span class='label'>relationship:</span> <span class='kw'>nil</span><span class='comma'>,</span>
      <span class='label'>script_id:</span> <span class='id identifier rubyid_painless_script'>painless_script</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
      <span class='label'>id_source:</span> <span class='id identifier rubyid_id_source'>id_source</span><span class='comma'>,</span>
      <span class='label'>routing_value_source:</span> <span class='id identifier rubyid_routing_value_source'>routing_value_source</span><span class='comma'>,</span>
      <span class='label'>rollover_timestamp_value_source:</span> <span class='id identifier rubyid_rollover_timestamp_value_source'>rollover_timestamp_value_source</span><span class='comma'>,</span>
      <span class='label'>metadata_params:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span>
      <span class='label'>data_params:</span> <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:source_field</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
        <span class='lbracket'>[</span><span class='id identifier rubyid_f'>f</span><span class='comma'>,</span> <span class='const'>SchemaArtifacts</span><span class='op'>::</span><span class='const'>RuntimeMetadata</span><span class='op'>::</span><span class='const'>DynamicParam</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>source_path:</span> <span class='id identifier rubyid_f'>f</span><span class='comma'>,</span> <span class='label'>cardinality:</span> <span class='symbol'>:many</span><span class='rparen'>)</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_generate_script'>generate_script</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Errors</span><span class='op'>::</span><span class='const'>SchemaError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`derive_indexed_type_fields` definition for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='embexpr_end'>}</span><span class='tstring_content'> (from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_type'>source_type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>) </span><span class='tstring_end'>&quot;</span></span> \
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>has no derived field definitions.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_sorted_fields'>sorted_fields</span> <span class='op'>=</span> <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:destination_field</span><span class='rparen'>)</span>

    <span class='comment'># We use `uniq` here to avoid re-doing the same setup multiple times, since multiple fields can sometimes
</span>    <span class='comment'># need the same setup (such as initializing a common parent field to an empty map).
</span>    <span class='id identifier rubyid_function_defs'>function_defs</span> <span class='op'>=</span> <span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:function_definitions</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:strip</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>

    <span class='id identifier rubyid_setup_statements'>setup_statements</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>STATIC_SETUP_STATEMENTS</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:setup_statements</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:strip</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_apply_update_statements'>apply_update_statements</span> <span class='op'>=</span> <span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_apply_update_statement'>apply_update_statement</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span> <span class='rbrace'>}</span>

    <span class='comment'># Note: comments in the script are effectively &quot;free&quot; since:
</span>    <span class='comment'>#
</span>    <span class='comment'>#   - The compiler will strip them out.
</span>    <span class='comment'>#   - We only send the script to the datastore once (when configuring the cluster), and later
</span>    <span class='comment'>#     reference it only by id--so we don&#39;t pay for the larger payload on each indexing request.
</span>    <span class='heredoc_beg'>&lt;&lt;~EOS</span>
<span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_function_defs'>function_defs</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>
</span><span class='tstring_content'>
</span><span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_setup_statements'>setup_statements</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>
</span><span class='tstring_content'>
</span><span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_apply_update_statements'>apply_update_statements</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>
</span><span class='tstring_content'>
</span><span class='tstring_content'>      if (!</span><span class='embexpr_beg'>#{</span><span class='const'>SCRIPT_ERRORS_VAR</span><span class='embexpr_end'>}</span><span class='tstring_content'>.isEmpty()) {
</span><span class='tstring_content'>        throw new IllegalArgumentException(&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>DERIVED_INDEX_FAILURE_MESSAGE_PREAMBLE</span><span class='embexpr_end'>}</span><span class='tstring_content'>: &quot; + </span><span class='embexpr_beg'>#{</span><span class='const'>SCRIPT_ERRORS_VAR</span><span class='embexpr_end'>}</span><span class='tstring_content'>.join(&quot; &quot;));
</span><span class='tstring_content'>      }
</span><span class='tstring_content'>
</span><span class='tstring_content'>      // For records with no new values to index, only skip the update if the document itself doesn&#39;t already exist.
</span><span class='tstring_content'>      // Otherwise create an (empty) document to reflect the fact that the id has been seen.
</span><span class='tstring_content'>      if (ctx._source.id != null &amp;&amp; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_was_noop_variable'>was_noop_variable</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> &amp;&amp; </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
</span><span class='tstring_content'>        ctx.op = &#39;none&#39;;
</span><span class='tstring_content'>      } else {
</span><span class='tstring_content'>        // Here we set `_source.id` because if we don&#39;t, it&#39;ll never be set, making these docs subtly
</span><span class='tstring_content'>        // different from docs indexed the normal way.
</span><span class='tstring_content'>        //
</span><span class='tstring_content'>        // Note also that we MUST use `params.id` instead of `ctx._id`. The latter works on an update
</span><span class='tstring_content'>        // of an existing document, but is unavailable when we are inserting the document for the first time.
</span><span class='tstring_content'>        ctx._source.id = params.id;
</span><span class='tstring_content'>      }
</span><span class='heredoc_end'>    EOS
</span>  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_apply_update_statement'>apply_update_statement</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>boolean </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_was_noop_variable'>was_noop_variable</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> = !</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_apply_operation_returning_update_status'>apply_operation_returning_update_status</span><span class='embexpr_end'>}</span><span class='tstring_content'>;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_was_noop_variable'>was_noop_variable</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_destination_field'>destination_field</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>__</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>_was_noop</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='const'>SCRIPT_ERRORS_VAR</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>scriptErrors</span><span class='tstring_end'>&quot;</span></span>

  <span class='const'>STATIC_SETUP_STATEMENTS</span> <span class='op'>=</span> <span class='heredoc_beg'>&lt;&lt;~EOS</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>
<span class='tstring_content'>    Map data = params.data;
</span><span class='tstring_content'>    // A variable to accumulate script errors so that we can surface _all_ issues and not just the first.
</span><span class='tstring_content'>    List </span><span class='embexpr_beg'>#{</span><span class='const'>SCRIPT_ERRORS_VAR</span><span class='embexpr_end'>}</span><span class='tstring_content'> = new ArrayList();
</span><span class='heredoc_end'>  EOS
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="rollover_timestamp_value_source=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="rollover_timestamp_value_source-instance_method">
  
    #<strong>rollover_timestamp_value_source</strong>  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns path to field on the source type used as the timestamp field for rollover.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>path to field on the source type used as the timestamp field for rollover</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'elasticgraph-schema_definition/lib/elastic_graph/schema_definition/indexing/derived_indexed_type.rb', line 67</span>

<span class='kw'>class</span> <span class='const'><span class='object_link'><a href="" title="ElasticGraph::SchemaDefinition::Indexing::DerivedIndexedType (class)">DerivedIndexedType</a></span></span> <span class='op'>&lt;</span> <span class='op'>::</span><span class='const'>Struct</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
  <span class='symbol'>:source_type</span><span class='comma'>,</span>
  <span class='symbol'>:destination_type_ref</span><span class='comma'>,</span>
  <span class='symbol'>:id_source</span><span class='comma'>,</span>
  <span class='symbol'>:routing_value_source</span><span class='comma'>,</span>
  <span class='symbol'>:rollover_timestamp_value_source</span><span class='comma'>,</span>
  <span class='symbol'>:fields</span>
<span class='rparen'>)</span>
  <span class='comment'># @param source_type [SchemaElements::ObjectType] the type used as a source for this derive type
</span>  <span class='comment'># @param destination_type_ref [SchemaElements::TypeReference] the derived type
</span>  <span class='comment'># @param id_source [String] path to field on the source type used as `id` on the derived type
</span>  <span class='comment'># @param routing_value_source [String, nil] path to field on the source type used for shard routing
</span>  <span class='comment'># @param rollover_timestamp_value_source [String, nil] path to field on the source type used as the timestamp field for rollover
</span>  <span class='comment'># @yield [DerivedIndexedType] the `DerivedIndexedType` instance
</span>  <span class='comment'># @api private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span>
    <span class='label'>source_type:</span><span class='comma'>,</span>
    <span class='label'>destination_type_ref:</span><span class='comma'>,</span>
    <span class='label'>id_source:</span><span class='comma'>,</span>
    <span class='label'>routing_value_source:</span><span class='comma'>,</span>
    <span class='label'>rollover_timestamp_value_source:</span>
  <span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='comment'># : ::Array[_DerivedField]
</span>    <span class='kw'>super</span><span class='lparen'>(</span>
      <span class='label'>source_type:</span> <span class='id identifier rubyid_source_type'>source_type</span><span class='comma'>,</span>
      <span class='label'>destination_type_ref:</span> <span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='comma'>,</span>
      <span class='label'>id_source:</span> <span class='id identifier rubyid_id_source'>id_source</span><span class='comma'>,</span>
      <span class='label'>routing_value_source:</span> <span class='id identifier rubyid_routing_value_source'>routing_value_source</span><span class='comma'>,</span>
      <span class='label'>rollover_timestamp_value_source:</span> <span class='id identifier rubyid_rollover_timestamp_value_source'>rollover_timestamp_value_source</span><span class='comma'>,</span>
      <span class='label'>fields:</span> <span class='id identifier rubyid_fields'>fields</span>
    <span class='rparen'>)</span>
    <span class='kw'>yield</span> <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain the set union of all values from
</span>  <span class='comment'># the `from` field on the source type. Values are only ever appended to the set, so the field will
</span>  <span class='comment'># act as an append-only set.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived set
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @return [DerivedIndexedType::AppendOnlySet]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;studentName&quot;, &quot;String&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.append_only_set &quot;students&quot;, from: &quot;studentName&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;students&quot;, &quot;[String!]!&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_append_only_set'>append_only_set</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/AppendOnlySet.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::AppendOnlySet (class)">AppendOnlySet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain a single immutable value from the
</span>  <span class='comment'># `from` field on the source type. Immutability is enforced by triggering an indexing failure with a
</span>  <span class='comment'># clear error if any event&#39;s source value is different from the value already indexed on this field.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived value
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @param nullable [Boolean] whether the field is allowed to be set to `null`. When set to false, events
</span>  <span class='comment'>#   that contain a `null` value in the `from` field will be rejected instead of setting the fieldâ€™s value
</span>  <span class='comment'>#   to `null`.
</span>  <span class='comment'># @param can_change_from_null [Boolean] whether a one-time mutation of the field value is allowed from
</span>  <span class='comment'>#   `null` to a non-`null` value. This can be useful when dealing with a field that may not have a value
</span>  <span class='comment'>#   on all source events. For example, if the source field was not initially part of the schema of your
</span>  <span class='comment'>#   source dataset, you may have old records that lack a value for this field. When set, this option
</span>  <span class='comment'>#   allows a one-time mutation of the field value from `null` to a non-`null` value. Once set to a
</span>  <span class='comment'>#   non-`null` value, any additional `null` values that are encountered will be ignored (ensuring that
</span>  <span class='comment'>#   the indexed data converges on the same state regardless of the order the events are ingested in).
</span>  <span class='comment'>#   Note: this option cannot be enabled when `nullable: false` has been set.
</span>  <span class='comment'># @return [DerivedFields::ImmutableValue]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseName&quot;, &quot;String&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.immutable_value &quot;name&quot;, from: &quot;courseName&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;name&quot;, &quot;String&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_immutable_value'>immutable_value</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='comma'>,</span> <span class='label'>nullable:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>can_change_from_null:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_nullable'>nullable</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_can_change_from_null'>can_change_from_null</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Errors</span><span class='op'>::</span><span class='const'>SchemaError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`can_change_from_null: true` is not allowed with `nullable: false` (as there would be no `null` values to change from).</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/ImmutableValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::ImmutableValue (class)">ImmutableValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='label'>destination_field:</span> <span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span>
      <span class='label'>source_field:</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span>
      <span class='label'>nullable:</span> <span class='id identifier rubyid_nullable'>nullable</span><span class='comma'>,</span>
      <span class='label'>can_change_from_null:</span> <span class='id identifier rubyid_can_change_from_null'>can_change_from_null</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain the minimum of all values from the `from`
</span>  <span class='comment'># field on the source type.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived value
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @return [DerivedIndexedType::MinOrMaxValue]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseStartDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.min_value &quot;firstOfferedDate&quot;, from: &quot;courseStartDate&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;firstOfferedDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_min_value'>min_value</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/MinOrMaxValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::MinOrMaxValue (class)">MinOrMaxValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='symbol'>:min</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain the maximum of all values from the `from`
</span>  <span class='comment'># field on the source type.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived value
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @return [DerivedIndexedType::MinOrMaxValue]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseStartDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.max_value &quot;mostRecentlyOfferedDate&quot;, from: &quot;courseStartDate&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;mostRecentlyOfferedDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_max_value'>max_value</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/MinOrMaxValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::MinOrMaxValue (class)">MinOrMaxValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='symbol'>:max</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># @return [Scripting::Script] Painless script that will maintain the derived fields
</span>  <span class='comment'># @api private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_painless_script'>painless_script</span>
    <span class='const'>Scripting</span><span class='op'>::</span><span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='label'>source:</span> <span class='id identifier rubyid_generate_script'>generate_script</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='comma'>,</span>
      <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='embexpr_end'>}</span><span class='tstring_content'>_from_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_type'>source_type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>language:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>painless</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>context:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>update</span><span class='tstring_end'>&quot;</span></span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># @return [SchemaArtifacts::RuntimeMetadata::UpdateTarget] runtime metadata for the source type
</span>  <span class='comment'># @api private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_runtime_metadata_for_source_type'>runtime_metadata_for_source_type</span>
    <span class='const'>SchemaArtifacts</span><span class='op'>::</span><span class='const'>RuntimeMetadata</span><span class='op'>::</span><span class='const'>UpdateTarget</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='label'>type:</span> <span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
      <span class='label'>relationship:</span> <span class='kw'>nil</span><span class='comma'>,</span>
      <span class='label'>script_id:</span> <span class='id identifier rubyid_painless_script'>painless_script</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
      <span class='label'>id_source:</span> <span class='id identifier rubyid_id_source'>id_source</span><span class='comma'>,</span>
      <span class='label'>routing_value_source:</span> <span class='id identifier rubyid_routing_value_source'>routing_value_source</span><span class='comma'>,</span>
      <span class='label'>rollover_timestamp_value_source:</span> <span class='id identifier rubyid_rollover_timestamp_value_source'>rollover_timestamp_value_source</span><span class='comma'>,</span>
      <span class='label'>metadata_params:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span>
      <span class='label'>data_params:</span> <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:source_field</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
        <span class='lbracket'>[</span><span class='id identifier rubyid_f'>f</span><span class='comma'>,</span> <span class='const'>SchemaArtifacts</span><span class='op'>::</span><span class='const'>RuntimeMetadata</span><span class='op'>::</span><span class='const'>DynamicParam</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>source_path:</span> <span class='id identifier rubyid_f'>f</span><span class='comma'>,</span> <span class='label'>cardinality:</span> <span class='symbol'>:many</span><span class='rparen'>)</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_generate_script'>generate_script</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Errors</span><span class='op'>::</span><span class='const'>SchemaError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`derive_indexed_type_fields` definition for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='embexpr_end'>}</span><span class='tstring_content'> (from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_type'>source_type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>) </span><span class='tstring_end'>&quot;</span></span> \
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>has no derived field definitions.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_sorted_fields'>sorted_fields</span> <span class='op'>=</span> <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:destination_field</span><span class='rparen'>)</span>

    <span class='comment'># We use `uniq` here to avoid re-doing the same setup multiple times, since multiple fields can sometimes
</span>    <span class='comment'># need the same setup (such as initializing a common parent field to an empty map).
</span>    <span class='id identifier rubyid_function_defs'>function_defs</span> <span class='op'>=</span> <span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:function_definitions</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:strip</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>

    <span class='id identifier rubyid_setup_statements'>setup_statements</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>STATIC_SETUP_STATEMENTS</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:setup_statements</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:strip</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_apply_update_statements'>apply_update_statements</span> <span class='op'>=</span> <span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_apply_update_statement'>apply_update_statement</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span> <span class='rbrace'>}</span>

    <span class='comment'># Note: comments in the script are effectively &quot;free&quot; since:
</span>    <span class='comment'>#
</span>    <span class='comment'>#   - The compiler will strip them out.
</span>    <span class='comment'>#   - We only send the script to the datastore once (when configuring the cluster), and later
</span>    <span class='comment'>#     reference it only by id--so we don&#39;t pay for the larger payload on each indexing request.
</span>    <span class='heredoc_beg'>&lt;&lt;~EOS</span>
<span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_function_defs'>function_defs</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>
</span><span class='tstring_content'>
</span><span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_setup_statements'>setup_statements</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>
</span><span class='tstring_content'>
</span><span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_apply_update_statements'>apply_update_statements</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>
</span><span class='tstring_content'>
</span><span class='tstring_content'>      if (!</span><span class='embexpr_beg'>#{</span><span class='const'>SCRIPT_ERRORS_VAR</span><span class='embexpr_end'>}</span><span class='tstring_content'>.isEmpty()) {
</span><span class='tstring_content'>        throw new IllegalArgumentException(&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>DERIVED_INDEX_FAILURE_MESSAGE_PREAMBLE</span><span class='embexpr_end'>}</span><span class='tstring_content'>: &quot; + </span><span class='embexpr_beg'>#{</span><span class='const'>SCRIPT_ERRORS_VAR</span><span class='embexpr_end'>}</span><span class='tstring_content'>.join(&quot; &quot;));
</span><span class='tstring_content'>      }
</span><span class='tstring_content'>
</span><span class='tstring_content'>      // For records with no new values to index, only skip the update if the document itself doesn&#39;t already exist.
</span><span class='tstring_content'>      // Otherwise create an (empty) document to reflect the fact that the id has been seen.
</span><span class='tstring_content'>      if (ctx._source.id != null &amp;&amp; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_was_noop_variable'>was_noop_variable</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> &amp;&amp; </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
</span><span class='tstring_content'>        ctx.op = &#39;none&#39;;
</span><span class='tstring_content'>      } else {
</span><span class='tstring_content'>        // Here we set `_source.id` because if we don&#39;t, it&#39;ll never be set, making these docs subtly
</span><span class='tstring_content'>        // different from docs indexed the normal way.
</span><span class='tstring_content'>        //
</span><span class='tstring_content'>        // Note also that we MUST use `params.id` instead of `ctx._id`. The latter works on an update
</span><span class='tstring_content'>        // of an existing document, but is unavailable when we are inserting the document for the first time.
</span><span class='tstring_content'>        ctx._source.id = params.id;
</span><span class='tstring_content'>      }
</span><span class='heredoc_end'>    EOS
</span>  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_apply_update_statement'>apply_update_statement</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>boolean </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_was_noop_variable'>was_noop_variable</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> = !</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_apply_operation_returning_update_status'>apply_operation_returning_update_status</span><span class='embexpr_end'>}</span><span class='tstring_content'>;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_was_noop_variable'>was_noop_variable</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_destination_field'>destination_field</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>__</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>_was_noop</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='const'>SCRIPT_ERRORS_VAR</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>scriptErrors</span><span class='tstring_end'>&quot;</span></span>

  <span class='const'>STATIC_SETUP_STATEMENTS</span> <span class='op'>=</span> <span class='heredoc_beg'>&lt;&lt;~EOS</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>
<span class='tstring_content'>    Map data = params.data;
</span><span class='tstring_content'>    // A variable to accumulate script errors so that we can surface _all_ issues and not just the first.
</span><span class='tstring_content'>    List </span><span class='embexpr_beg'>#{</span><span class='const'>SCRIPT_ERRORS_VAR</span><span class='embexpr_end'>}</span><span class='tstring_content'> = new ArrayList();
</span><span class='heredoc_end'>  EOS
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="routing_value_source=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="routing_value_source-instance_method">
  
    #<strong>routing_value_source</strong>  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns path to field on the source type used for shard routing.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>path to field on the source type used for shard routing</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'elasticgraph-schema_definition/lib/elastic_graph/schema_definition/indexing/derived_indexed_type.rb', line 67</span>

<span class='kw'>class</span> <span class='const'><span class='object_link'><a href="" title="ElasticGraph::SchemaDefinition::Indexing::DerivedIndexedType (class)">DerivedIndexedType</a></span></span> <span class='op'>&lt;</span> <span class='op'>::</span><span class='const'>Struct</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
  <span class='symbol'>:source_type</span><span class='comma'>,</span>
  <span class='symbol'>:destination_type_ref</span><span class='comma'>,</span>
  <span class='symbol'>:id_source</span><span class='comma'>,</span>
  <span class='symbol'>:routing_value_source</span><span class='comma'>,</span>
  <span class='symbol'>:rollover_timestamp_value_source</span><span class='comma'>,</span>
  <span class='symbol'>:fields</span>
<span class='rparen'>)</span>
  <span class='comment'># @param source_type [SchemaElements::ObjectType] the type used as a source for this derive type
</span>  <span class='comment'># @param destination_type_ref [SchemaElements::TypeReference] the derived type
</span>  <span class='comment'># @param id_source [String] path to field on the source type used as `id` on the derived type
</span>  <span class='comment'># @param routing_value_source [String, nil] path to field on the source type used for shard routing
</span>  <span class='comment'># @param rollover_timestamp_value_source [String, nil] path to field on the source type used as the timestamp field for rollover
</span>  <span class='comment'># @yield [DerivedIndexedType] the `DerivedIndexedType` instance
</span>  <span class='comment'># @api private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span>
    <span class='label'>source_type:</span><span class='comma'>,</span>
    <span class='label'>destination_type_ref:</span><span class='comma'>,</span>
    <span class='label'>id_source:</span><span class='comma'>,</span>
    <span class='label'>routing_value_source:</span><span class='comma'>,</span>
    <span class='label'>rollover_timestamp_value_source:</span>
  <span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='comment'># : ::Array[_DerivedField]
</span>    <span class='kw'>super</span><span class='lparen'>(</span>
      <span class='label'>source_type:</span> <span class='id identifier rubyid_source_type'>source_type</span><span class='comma'>,</span>
      <span class='label'>destination_type_ref:</span> <span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='comma'>,</span>
      <span class='label'>id_source:</span> <span class='id identifier rubyid_id_source'>id_source</span><span class='comma'>,</span>
      <span class='label'>routing_value_source:</span> <span class='id identifier rubyid_routing_value_source'>routing_value_source</span><span class='comma'>,</span>
      <span class='label'>rollover_timestamp_value_source:</span> <span class='id identifier rubyid_rollover_timestamp_value_source'>rollover_timestamp_value_source</span><span class='comma'>,</span>
      <span class='label'>fields:</span> <span class='id identifier rubyid_fields'>fields</span>
    <span class='rparen'>)</span>
    <span class='kw'>yield</span> <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain the set union of all values from
</span>  <span class='comment'># the `from` field on the source type. Values are only ever appended to the set, so the field will
</span>  <span class='comment'># act as an append-only set.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived set
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @return [DerivedIndexedType::AppendOnlySet]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;studentName&quot;, &quot;String&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.append_only_set &quot;students&quot;, from: &quot;studentName&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;students&quot;, &quot;[String!]!&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_append_only_set'>append_only_set</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/AppendOnlySet.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::AppendOnlySet (class)">AppendOnlySet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain a single immutable value from the
</span>  <span class='comment'># `from` field on the source type. Immutability is enforced by triggering an indexing failure with a
</span>  <span class='comment'># clear error if any event&#39;s source value is different from the value already indexed on this field.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived value
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @param nullable [Boolean] whether the field is allowed to be set to `null`. When set to false, events
</span>  <span class='comment'>#   that contain a `null` value in the `from` field will be rejected instead of setting the fieldâ€™s value
</span>  <span class='comment'>#   to `null`.
</span>  <span class='comment'># @param can_change_from_null [Boolean] whether a one-time mutation of the field value is allowed from
</span>  <span class='comment'>#   `null` to a non-`null` value. This can be useful when dealing with a field that may not have a value
</span>  <span class='comment'>#   on all source events. For example, if the source field was not initially part of the schema of your
</span>  <span class='comment'>#   source dataset, you may have old records that lack a value for this field. When set, this option
</span>  <span class='comment'>#   allows a one-time mutation of the field value from `null` to a non-`null` value. Once set to a
</span>  <span class='comment'>#   non-`null` value, any additional `null` values that are encountered will be ignored (ensuring that
</span>  <span class='comment'>#   the indexed data converges on the same state regardless of the order the events are ingested in).
</span>  <span class='comment'>#   Note: this option cannot be enabled when `nullable: false` has been set.
</span>  <span class='comment'># @return [DerivedFields::ImmutableValue]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseName&quot;, &quot;String&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.immutable_value &quot;name&quot;, from: &quot;courseName&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;name&quot;, &quot;String&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_immutable_value'>immutable_value</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='comma'>,</span> <span class='label'>nullable:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>can_change_from_null:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_nullable'>nullable</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_can_change_from_null'>can_change_from_null</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Errors</span><span class='op'>::</span><span class='const'>SchemaError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`can_change_from_null: true` is not allowed with `nullable: false` (as there would be no `null` values to change from).</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/ImmutableValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::ImmutableValue (class)">ImmutableValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='label'>destination_field:</span> <span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span>
      <span class='label'>source_field:</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span>
      <span class='label'>nullable:</span> <span class='id identifier rubyid_nullable'>nullable</span><span class='comma'>,</span>
      <span class='label'>can_change_from_null:</span> <span class='id identifier rubyid_can_change_from_null'>can_change_from_null</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain the minimum of all values from the `from`
</span>  <span class='comment'># field on the source type.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived value
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @return [DerivedIndexedType::MinOrMaxValue]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseStartDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.min_value &quot;firstOfferedDate&quot;, from: &quot;courseStartDate&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;firstOfferedDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_min_value'>min_value</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/MinOrMaxValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::MinOrMaxValue (class)">MinOrMaxValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='symbol'>:min</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain the maximum of all values from the `from`
</span>  <span class='comment'># field on the source type.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived value
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @return [DerivedIndexedType::MinOrMaxValue]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseStartDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.max_value &quot;mostRecentlyOfferedDate&quot;, from: &quot;courseStartDate&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;mostRecentlyOfferedDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_max_value'>max_value</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/MinOrMaxValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::MinOrMaxValue (class)">MinOrMaxValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='symbol'>:max</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># @return [Scripting::Script] Painless script that will maintain the derived fields
</span>  <span class='comment'># @api private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_painless_script'>painless_script</span>
    <span class='const'>Scripting</span><span class='op'>::</span><span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='label'>source:</span> <span class='id identifier rubyid_generate_script'>generate_script</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='comma'>,</span>
      <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='embexpr_end'>}</span><span class='tstring_content'>_from_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_type'>source_type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>language:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>painless</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>context:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>update</span><span class='tstring_end'>&quot;</span></span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># @return [SchemaArtifacts::RuntimeMetadata::UpdateTarget] runtime metadata for the source type
</span>  <span class='comment'># @api private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_runtime_metadata_for_source_type'>runtime_metadata_for_source_type</span>
    <span class='const'>SchemaArtifacts</span><span class='op'>::</span><span class='const'>RuntimeMetadata</span><span class='op'>::</span><span class='const'>UpdateTarget</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='label'>type:</span> <span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
      <span class='label'>relationship:</span> <span class='kw'>nil</span><span class='comma'>,</span>
      <span class='label'>script_id:</span> <span class='id identifier rubyid_painless_script'>painless_script</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
      <span class='label'>id_source:</span> <span class='id identifier rubyid_id_source'>id_source</span><span class='comma'>,</span>
      <span class='label'>routing_value_source:</span> <span class='id identifier rubyid_routing_value_source'>routing_value_source</span><span class='comma'>,</span>
      <span class='label'>rollover_timestamp_value_source:</span> <span class='id identifier rubyid_rollover_timestamp_value_source'>rollover_timestamp_value_source</span><span class='comma'>,</span>
      <span class='label'>metadata_params:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span>
      <span class='label'>data_params:</span> <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:source_field</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
        <span class='lbracket'>[</span><span class='id identifier rubyid_f'>f</span><span class='comma'>,</span> <span class='const'>SchemaArtifacts</span><span class='op'>::</span><span class='const'>RuntimeMetadata</span><span class='op'>::</span><span class='const'>DynamicParam</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>source_path:</span> <span class='id identifier rubyid_f'>f</span><span class='comma'>,</span> <span class='label'>cardinality:</span> <span class='symbol'>:many</span><span class='rparen'>)</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_generate_script'>generate_script</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Errors</span><span class='op'>::</span><span class='const'>SchemaError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`derive_indexed_type_fields` definition for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='embexpr_end'>}</span><span class='tstring_content'> (from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_type'>source_type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>) </span><span class='tstring_end'>&quot;</span></span> \
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>has no derived field definitions.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_sorted_fields'>sorted_fields</span> <span class='op'>=</span> <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:destination_field</span><span class='rparen'>)</span>

    <span class='comment'># We use `uniq` here to avoid re-doing the same setup multiple times, since multiple fields can sometimes
</span>    <span class='comment'># need the same setup (such as initializing a common parent field to an empty map).
</span>    <span class='id identifier rubyid_function_defs'>function_defs</span> <span class='op'>=</span> <span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:function_definitions</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:strip</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>

    <span class='id identifier rubyid_setup_statements'>setup_statements</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>STATIC_SETUP_STATEMENTS</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:setup_statements</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:strip</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_apply_update_statements'>apply_update_statements</span> <span class='op'>=</span> <span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_apply_update_statement'>apply_update_statement</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span> <span class='rbrace'>}</span>

    <span class='comment'># Note: comments in the script are effectively &quot;free&quot; since:
</span>    <span class='comment'>#
</span>    <span class='comment'>#   - The compiler will strip them out.
</span>    <span class='comment'>#   - We only send the script to the datastore once (when configuring the cluster), and later
</span>    <span class='comment'>#     reference it only by id--so we don&#39;t pay for the larger payload on each indexing request.
</span>    <span class='heredoc_beg'>&lt;&lt;~EOS</span>
<span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_function_defs'>function_defs</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>
</span><span class='tstring_content'>
</span><span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_setup_statements'>setup_statements</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>
</span><span class='tstring_content'>
</span><span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_apply_update_statements'>apply_update_statements</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>
</span><span class='tstring_content'>
</span><span class='tstring_content'>      if (!</span><span class='embexpr_beg'>#{</span><span class='const'>SCRIPT_ERRORS_VAR</span><span class='embexpr_end'>}</span><span class='tstring_content'>.isEmpty()) {
</span><span class='tstring_content'>        throw new IllegalArgumentException(&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>DERIVED_INDEX_FAILURE_MESSAGE_PREAMBLE</span><span class='embexpr_end'>}</span><span class='tstring_content'>: &quot; + </span><span class='embexpr_beg'>#{</span><span class='const'>SCRIPT_ERRORS_VAR</span><span class='embexpr_end'>}</span><span class='tstring_content'>.join(&quot; &quot;));
</span><span class='tstring_content'>      }
</span><span class='tstring_content'>
</span><span class='tstring_content'>      // For records with no new values to index, only skip the update if the document itself doesn&#39;t already exist.
</span><span class='tstring_content'>      // Otherwise create an (empty) document to reflect the fact that the id has been seen.
</span><span class='tstring_content'>      if (ctx._source.id != null &amp;&amp; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_was_noop_variable'>was_noop_variable</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> &amp;&amp; </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
</span><span class='tstring_content'>        ctx.op = &#39;none&#39;;
</span><span class='tstring_content'>      } else {
</span><span class='tstring_content'>        // Here we set `_source.id` because if we don&#39;t, it&#39;ll never be set, making these docs subtly
</span><span class='tstring_content'>        // different from docs indexed the normal way.
</span><span class='tstring_content'>        //
</span><span class='tstring_content'>        // Note also that we MUST use `params.id` instead of `ctx._id`. The latter works on an update
</span><span class='tstring_content'>        // of an existing document, but is unavailable when we are inserting the document for the first time.
</span><span class='tstring_content'>        ctx._source.id = params.id;
</span><span class='tstring_content'>      }
</span><span class='heredoc_end'>    EOS
</span>  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_apply_update_statement'>apply_update_statement</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>boolean </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_was_noop_variable'>was_noop_variable</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> = !</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_apply_operation_returning_update_status'>apply_operation_returning_update_status</span><span class='embexpr_end'>}</span><span class='tstring_content'>;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_was_noop_variable'>was_noop_variable</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_destination_field'>destination_field</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>__</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>_was_noop</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='const'>SCRIPT_ERRORS_VAR</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>scriptErrors</span><span class='tstring_end'>&quot;</span></span>

  <span class='const'>STATIC_SETUP_STATEMENTS</span> <span class='op'>=</span> <span class='heredoc_beg'>&lt;&lt;~EOS</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>
<span class='tstring_content'>    Map data = params.data;
</span><span class='tstring_content'>    // A variable to accumulate script errors so that we can surface _all_ issues and not just the first.
</span><span class='tstring_content'>    List </span><span class='embexpr_beg'>#{</span><span class='const'>SCRIPT_ERRORS_VAR</span><span class='embexpr_end'>}</span><span class='tstring_content'> = new ArrayList();
</span><span class='heredoc_end'>  EOS
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="source_type=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="source_type-instance_method">
  
    #<strong>source_type</strong>  &#x21d2; <tt><span class='object_link'><a href="../SchemaElements/ObjectType.html" title="ElasticGraph::SchemaDefinition::SchemaElements::ObjectType (class)">SchemaElements::ObjectType</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the type used as a source for this derive type.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../SchemaElements/ObjectType.html" title="ElasticGraph::SchemaDefinition::SchemaElements::ObjectType (class)">SchemaElements::ObjectType</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the type used as a source for this derive type</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'elasticgraph-schema_definition/lib/elastic_graph/schema_definition/indexing/derived_indexed_type.rb', line 67</span>

<span class='kw'>class</span> <span class='const'><span class='object_link'><a href="" title="ElasticGraph::SchemaDefinition::Indexing::DerivedIndexedType (class)">DerivedIndexedType</a></span></span> <span class='op'>&lt;</span> <span class='op'>::</span><span class='const'>Struct</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
  <span class='symbol'>:source_type</span><span class='comma'>,</span>
  <span class='symbol'>:destination_type_ref</span><span class='comma'>,</span>
  <span class='symbol'>:id_source</span><span class='comma'>,</span>
  <span class='symbol'>:routing_value_source</span><span class='comma'>,</span>
  <span class='symbol'>:rollover_timestamp_value_source</span><span class='comma'>,</span>
  <span class='symbol'>:fields</span>
<span class='rparen'>)</span>
  <span class='comment'># @param source_type [SchemaElements::ObjectType] the type used as a source for this derive type
</span>  <span class='comment'># @param destination_type_ref [SchemaElements::TypeReference] the derived type
</span>  <span class='comment'># @param id_source [String] path to field on the source type used as `id` on the derived type
</span>  <span class='comment'># @param routing_value_source [String, nil] path to field on the source type used for shard routing
</span>  <span class='comment'># @param rollover_timestamp_value_source [String, nil] path to field on the source type used as the timestamp field for rollover
</span>  <span class='comment'># @yield [DerivedIndexedType] the `DerivedIndexedType` instance
</span>  <span class='comment'># @api private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span>
    <span class='label'>source_type:</span><span class='comma'>,</span>
    <span class='label'>destination_type_ref:</span><span class='comma'>,</span>
    <span class='label'>id_source:</span><span class='comma'>,</span>
    <span class='label'>routing_value_source:</span><span class='comma'>,</span>
    <span class='label'>rollover_timestamp_value_source:</span>
  <span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='comment'># : ::Array[_DerivedField]
</span>    <span class='kw'>super</span><span class='lparen'>(</span>
      <span class='label'>source_type:</span> <span class='id identifier rubyid_source_type'>source_type</span><span class='comma'>,</span>
      <span class='label'>destination_type_ref:</span> <span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='comma'>,</span>
      <span class='label'>id_source:</span> <span class='id identifier rubyid_id_source'>id_source</span><span class='comma'>,</span>
      <span class='label'>routing_value_source:</span> <span class='id identifier rubyid_routing_value_source'>routing_value_source</span><span class='comma'>,</span>
      <span class='label'>rollover_timestamp_value_source:</span> <span class='id identifier rubyid_rollover_timestamp_value_source'>rollover_timestamp_value_source</span><span class='comma'>,</span>
      <span class='label'>fields:</span> <span class='id identifier rubyid_fields'>fields</span>
    <span class='rparen'>)</span>
    <span class='kw'>yield</span> <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain the set union of all values from
</span>  <span class='comment'># the `from` field on the source type. Values are only ever appended to the set, so the field will
</span>  <span class='comment'># act as an append-only set.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived set
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @return [DerivedIndexedType::AppendOnlySet]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;studentName&quot;, &quot;String&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.append_only_set &quot;students&quot;, from: &quot;studentName&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;students&quot;, &quot;[String!]!&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_append_only_set'>append_only_set</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/AppendOnlySet.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::AppendOnlySet (class)">AppendOnlySet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain a single immutable value from the
</span>  <span class='comment'># `from` field on the source type. Immutability is enforced by triggering an indexing failure with a
</span>  <span class='comment'># clear error if any event&#39;s source value is different from the value already indexed on this field.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived value
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @param nullable [Boolean] whether the field is allowed to be set to `null`. When set to false, events
</span>  <span class='comment'>#   that contain a `null` value in the `from` field will be rejected instead of setting the fieldâ€™s value
</span>  <span class='comment'>#   to `null`.
</span>  <span class='comment'># @param can_change_from_null [Boolean] whether a one-time mutation of the field value is allowed from
</span>  <span class='comment'>#   `null` to a non-`null` value. This can be useful when dealing with a field that may not have a value
</span>  <span class='comment'>#   on all source events. For example, if the source field was not initially part of the schema of your
</span>  <span class='comment'>#   source dataset, you may have old records that lack a value for this field. When set, this option
</span>  <span class='comment'>#   allows a one-time mutation of the field value from `null` to a non-`null` value. Once set to a
</span>  <span class='comment'>#   non-`null` value, any additional `null` values that are encountered will be ignored (ensuring that
</span>  <span class='comment'>#   the indexed data converges on the same state regardless of the order the events are ingested in).
</span>  <span class='comment'>#   Note: this option cannot be enabled when `nullable: false` has been set.
</span>  <span class='comment'># @return [DerivedFields::ImmutableValue]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseName&quot;, &quot;String&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.immutable_value &quot;name&quot;, from: &quot;courseName&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;name&quot;, &quot;String&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_immutable_value'>immutable_value</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='comma'>,</span> <span class='label'>nullable:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>can_change_from_null:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_nullable'>nullable</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_can_change_from_null'>can_change_from_null</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Errors</span><span class='op'>::</span><span class='const'>SchemaError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`can_change_from_null: true` is not allowed with `nullable: false` (as there would be no `null` values to change from).</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/ImmutableValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::ImmutableValue (class)">ImmutableValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='label'>destination_field:</span> <span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span>
      <span class='label'>source_field:</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span>
      <span class='label'>nullable:</span> <span class='id identifier rubyid_nullable'>nullable</span><span class='comma'>,</span>
      <span class='label'>can_change_from_null:</span> <span class='id identifier rubyid_can_change_from_null'>can_change_from_null</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain the minimum of all values from the `from`
</span>  <span class='comment'># field on the source type.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived value
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @return [DerivedIndexedType::MinOrMaxValue]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseStartDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.min_value &quot;firstOfferedDate&quot;, from: &quot;courseStartDate&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;firstOfferedDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_min_value'>min_value</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/MinOrMaxValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::MinOrMaxValue (class)">MinOrMaxValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='symbol'>:min</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Configures `field_name` (on the derived indexing type) to contain the maximum of all values from the `from`
</span>  <span class='comment'># field on the source type.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param field_name [String] name of field on the derived indexing type to store the derived value
</span>  <span class='comment'># @param from [String] path to field on the source type to source values from
</span>  <span class='comment'># @return [DerivedIndexedType::MinOrMaxValue]
</span>  <span class='comment'>#
</span>  <span class='comment'># @example
</span>  <span class='comment'>#   ElasticGraph.define_schema do |schema|
</span>  <span class='comment'>#     schema.object_type &quot;StudentCourseEnrollment&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseId&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;courseStartDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;student_course_enrollments&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.derive_indexed_type_fields &quot;Course&quot;, from_id: &quot;courseId&quot; do |derive|
</span>  <span class='comment'>#         derive.max_value &quot;mostRecentlyOfferedDate&quot;, from: &quot;courseStartDate&quot;
</span>  <span class='comment'>#       end
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'>#     schema.object_type &quot;Course&quot; do |t|
</span>  <span class='comment'>#       t.field &quot;id&quot;, &quot;ID&quot;
</span>  <span class='comment'>#       t.field &quot;mostRecentlyOfferedDate&quot;, &quot;Date&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'>#       t.index &quot;courses&quot;
</span>  <span class='comment'>#     end
</span>  <span class='comment'>#   end
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_max_value'>max_value</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/MinOrMaxValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::MinOrMaxValue (class)">MinOrMaxValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='symbol'>:max</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># @return [Scripting::Script] Painless script that will maintain the derived fields
</span>  <span class='comment'># @api private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_painless_script'>painless_script</span>
    <span class='const'>Scripting</span><span class='op'>::</span><span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='label'>source:</span> <span class='id identifier rubyid_generate_script'>generate_script</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='comma'>,</span>
      <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='embexpr_end'>}</span><span class='tstring_content'>_from_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_type'>source_type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>language:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>painless</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>context:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>update</span><span class='tstring_end'>&quot;</span></span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># @return [SchemaArtifacts::RuntimeMetadata::UpdateTarget] runtime metadata for the source type
</span>  <span class='comment'># @api private
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_runtime_metadata_for_source_type'>runtime_metadata_for_source_type</span>
    <span class='const'>SchemaArtifacts</span><span class='op'>::</span><span class='const'>RuntimeMetadata</span><span class='op'>::</span><span class='const'>UpdateTarget</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='label'>type:</span> <span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
      <span class='label'>relationship:</span> <span class='kw'>nil</span><span class='comma'>,</span>
      <span class='label'>script_id:</span> <span class='id identifier rubyid_painless_script'>painless_script</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
      <span class='label'>id_source:</span> <span class='id identifier rubyid_id_source'>id_source</span><span class='comma'>,</span>
      <span class='label'>routing_value_source:</span> <span class='id identifier rubyid_routing_value_source'>routing_value_source</span><span class='comma'>,</span>
      <span class='label'>rollover_timestamp_value_source:</span> <span class='id identifier rubyid_rollover_timestamp_value_source'>rollover_timestamp_value_source</span><span class='comma'>,</span>
      <span class='label'>metadata_params:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span>
      <span class='label'>data_params:</span> <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:source_field</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
        <span class='lbracket'>[</span><span class='id identifier rubyid_f'>f</span><span class='comma'>,</span> <span class='const'>SchemaArtifacts</span><span class='op'>::</span><span class='const'>RuntimeMetadata</span><span class='op'>::</span><span class='const'>DynamicParam</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>source_path:</span> <span class='id identifier rubyid_f'>f</span><span class='comma'>,</span> <span class='label'>cardinality:</span> <span class='symbol'>:many</span><span class='rparen'>)</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_generate_script'>generate_script</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Errors</span><span class='op'>::</span><span class='const'>SchemaError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`derive_indexed_type_fields` definition for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='embexpr_end'>}</span><span class='tstring_content'> (from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_type'>source_type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>) </span><span class='tstring_end'>&quot;</span></span> \
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>has no derived field definitions.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_sorted_fields'>sorted_fields</span> <span class='op'>=</span> <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:destination_field</span><span class='rparen'>)</span>

    <span class='comment'># We use `uniq` here to avoid re-doing the same setup multiple times, since multiple fields can sometimes
</span>    <span class='comment'># need the same setup (such as initializing a common parent field to an empty map).
</span>    <span class='id identifier rubyid_function_defs'>function_defs</span> <span class='op'>=</span> <span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:function_definitions</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:strip</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>

    <span class='id identifier rubyid_setup_statements'>setup_statements</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>STATIC_SETUP_STATEMENTS</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:setup_statements</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:strip</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_apply_update_statements'>apply_update_statements</span> <span class='op'>=</span> <span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_apply_update_statement'>apply_update_statement</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span> <span class='rbrace'>}</span>

    <span class='comment'># Note: comments in the script are effectively &quot;free&quot; since:
</span>    <span class='comment'>#
</span>    <span class='comment'>#   - The compiler will strip them out.
</span>    <span class='comment'>#   - We only send the script to the datastore once (when configuring the cluster), and later
</span>    <span class='comment'>#     reference it only by id--so we don&#39;t pay for the larger payload on each indexing request.
</span>    <span class='heredoc_beg'>&lt;&lt;~EOS</span>
<span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_function_defs'>function_defs</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>
</span><span class='tstring_content'>
</span><span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_setup_statements'>setup_statements</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>
</span><span class='tstring_content'>
</span><span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_apply_update_statements'>apply_update_statements</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>
</span><span class='tstring_content'>
</span><span class='tstring_content'>      if (!</span><span class='embexpr_beg'>#{</span><span class='const'>SCRIPT_ERRORS_VAR</span><span class='embexpr_end'>}</span><span class='tstring_content'>.isEmpty()) {
</span><span class='tstring_content'>        throw new IllegalArgumentException(&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>DERIVED_INDEX_FAILURE_MESSAGE_PREAMBLE</span><span class='embexpr_end'>}</span><span class='tstring_content'>: &quot; + </span><span class='embexpr_beg'>#{</span><span class='const'>SCRIPT_ERRORS_VAR</span><span class='embexpr_end'>}</span><span class='tstring_content'>.join(&quot; &quot;));
</span><span class='tstring_content'>      }
</span><span class='tstring_content'>
</span><span class='tstring_content'>      // For records with no new values to index, only skip the update if the document itself doesn&#39;t already exist.
</span><span class='tstring_content'>      // Otherwise create an (empty) document to reflect the fact that the id has been seen.
</span><span class='tstring_content'>      if (ctx._source.id != null &amp;&amp; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sorted_fields'>sorted_fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_was_noop_variable'>was_noop_variable</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> &amp;&amp; </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
</span><span class='tstring_content'>        ctx.op = &#39;none&#39;;
</span><span class='tstring_content'>      } else {
</span><span class='tstring_content'>        // Here we set `_source.id` because if we don&#39;t, it&#39;ll never be set, making these docs subtly
</span><span class='tstring_content'>        // different from docs indexed the normal way.
</span><span class='tstring_content'>        //
</span><span class='tstring_content'>        // Note also that we MUST use `params.id` instead of `ctx._id`. The latter works on an update
</span><span class='tstring_content'>        // of an existing document, but is unavailable when we are inserting the document for the first time.
</span><span class='tstring_content'>        ctx._source.id = params.id;
</span><span class='tstring_content'>      }
</span><span class='heredoc_end'>    EOS
</span>  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_apply_update_statement'>apply_update_statement</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>boolean </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_was_noop_variable'>was_noop_variable</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> = !</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_apply_operation_returning_update_status'>apply_operation_returning_update_status</span><span class='embexpr_end'>}</span><span class='tstring_content'>;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_was_noop_variable'>was_noop_variable</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_destination_field'>destination_field</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>__</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>_was_noop</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='const'>SCRIPT_ERRORS_VAR</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>scriptErrors</span><span class='tstring_end'>&quot;</span></span>

  <span class='const'>STATIC_SETUP_STATEMENTS</span> <span class='op'>=</span> <span class='heredoc_beg'>&lt;&lt;~EOS</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>
<span class='tstring_content'>    Map data = params.data;
</span><span class='tstring_content'>    // A variable to accumulate script errors so that we can surface _all_ issues and not just the first.
</span><span class='tstring_content'>    List </span><span class='embexpr_beg'>#{</span><span class='const'>SCRIPT_ERRORS_VAR</span><span class='embexpr_end'>}</span><span class='tstring_content'> = new ArrayList();
</span><span class='heredoc_end'>  EOS
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="append_only_set-instance_method">
  
    #<strong>append_only_set</strong>(field_name, from:)  &#x21d2; <tt>DerivedIndexedType::AppendOnlySet</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Configures <code>field_name</code> (on the derived indexing type) to contain the set union of all values from
the <code>from</code> field on the source type. Values are only ever appended to the set, so the field will
act as an append-only set.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="../../../ElasticGraph.html" title="ElasticGraph (module)">ElasticGraph</a></span></span><span class='period'>.</span><span class='id identifier rubyid_define_schema'><span class='object_link'><a href="../../../ElasticGraph.html#define_schema-class_method" title="ElasticGraph.define_schema (method)">define_schema</a></span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_schema'>schema</span><span class='op'>|</span>
  <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_object_type'>object_type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>StudentCourseEnrollment</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseId</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>studentName</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>String</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>student_course_enrollments</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_derive_indexed_type_fields'>derive_indexed_type_fields</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Course</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>from_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseId</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_derive'>derive</span><span class='op'>|</span>
      <span class='id identifier rubyid_derive'>derive</span><span class='period'>.</span><span class='id identifier rubyid_append_only_set'>append_only_set</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>students</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>from:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>studentName</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_object_type'>object_type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Course</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>students</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[String!]!</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courses</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>field_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>name of field on the derived indexing type to store the derived set</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>from</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>path to field on the source type to source values from</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>DerivedIndexedType::AppendOnlySet</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'elasticgraph-schema_definition/lib/elastic_graph/schema_definition/indexing/derived_indexed_type.rb', line 130</span>

<span class='kw'>def</span> <span class='id identifier rubyid_append_only_set'>append_only_set</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/AppendOnlySet.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::AppendOnlySet (class)">AppendOnlySet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="immutable_value-instance_method">
  
    #<strong>immutable_value</strong>(field_name, from:, nullable: true, can_change_from_null: false)  &#x21d2; <tt><span class='object_link'><a href="DerivedFields/ImmutableValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::ImmutableValue (class)">DerivedFields::ImmutableValue</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Configures <code>field_name</code> (on the derived indexing type) to contain a single immutable value from the
<code>from</code> field on the source type. Immutability is enforced by triggering an indexing failure with a
clear error if any eventâ€™s source value is different from the value already indexed on this field.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="../../../ElasticGraph.html" title="ElasticGraph (module)">ElasticGraph</a></span></span><span class='period'>.</span><span class='id identifier rubyid_define_schema'><span class='object_link'><a href="../../../ElasticGraph.html#define_schema-class_method" title="ElasticGraph.define_schema (method)">define_schema</a></span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_schema'>schema</span><span class='op'>|</span>
  <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_object_type'>object_type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>StudentCourseEnrollment</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseId</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseName</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>String</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>student_course_enrollments</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_derive_indexed_type_fields'>derive_indexed_type_fields</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Course</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>from_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseId</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_derive'>derive</span><span class='op'>|</span>
      <span class='id identifier rubyid_derive'>derive</span><span class='period'>.</span><span class='id identifier rubyid_immutable_value'>immutable_value</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>from:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseName</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_object_type'>object_type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Course</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>String</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courses</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>field_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>name of field on the derived indexing type to store the derived value</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>from</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>path to field on the source type to source values from</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>nullable</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>whether the field is allowed to be set to <code>null</code>. When set to false, events
that contain a <code>null</code> value in the <code>from</code> field will be rejected instead of setting the fieldâ€™s value
to <code>null</code>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>can_change_from_null</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>whether a one-time mutation of the field value is allowed from
<code>null</code> to a non-<code>null</code> value. This can be useful when dealing with a field that may not have a value
on all source events. For example, if the source field was not initially part of the schema of your
source dataset, you may have old records that lack a value for this field. When set, this option
allows a one-time mutation of the field value from <code>null</code> to a non-<code>null</code> value. Once set to a
non-<code>null</code> value, any additional <code>null</code> values that are encountered will be ignored (ensuring that
the indexed data converges on the same state regardless of the order the events are ingested in).
Note: this option cannot be enabled when <code>nullable: false</code> has been set.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="DerivedFields/ImmutableValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::ImmutableValue (class)">DerivedFields::ImmutableValue</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


174
175
176
177
178
179
180
181
182
183
184
185</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'elasticgraph-schema_definition/lib/elastic_graph/schema_definition/indexing/derived_indexed_type.rb', line 174</span>

<span class='kw'>def</span> <span class='id identifier rubyid_immutable_value'>immutable_value</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='comma'>,</span> <span class='label'>nullable:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>can_change_from_null:</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_nullable'>nullable</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_can_change_from_null'>can_change_from_null</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Errors</span><span class='op'>::</span><span class='const'>SchemaError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`can_change_from_null: true` is not allowed with `nullable: false` (as there would be no `null` values to change from).</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/ImmutableValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::ImmutableValue (class)">ImmutableValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
    <span class='label'>destination_field:</span> <span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span>
    <span class='label'>source_field:</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span>
    <span class='label'>nullable:</span> <span class='id identifier rubyid_nullable'>nullable</span><span class='comma'>,</span>
    <span class='label'>can_change_from_null:</span> <span class='id identifier rubyid_can_change_from_null'>can_change_from_null</span>
  <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="max_value-instance_method">
  
    #<strong>max_value</strong>(field_name, from:)  &#x21d2; <tt>DerivedIndexedType::MinOrMaxValue</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Configures <code>field_name</code> (on the derived indexing type) to contain the maximum of all values from the <code>from</code>
field on the source type.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="../../../ElasticGraph.html" title="ElasticGraph (module)">ElasticGraph</a></span></span><span class='period'>.</span><span class='id identifier rubyid_define_schema'><span class='object_link'><a href="../../../ElasticGraph.html#define_schema-class_method" title="ElasticGraph.define_schema (method)">define_schema</a></span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_schema'>schema</span><span class='op'>|</span>
  <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_object_type'>object_type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>StudentCourseEnrollment</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseId</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseStartDate</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Date</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>student_course_enrollments</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_derive_indexed_type_fields'>derive_indexed_type_fields</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Course</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>from_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseId</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_derive'>derive</span><span class='op'>|</span>
      <span class='id identifier rubyid_derive'>derive</span><span class='period'>.</span><span class='id identifier rubyid_max_value'>max_value</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mostRecentlyOfferedDate</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>from:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseStartDate</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_object_type'>object_type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Course</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mostRecentlyOfferedDate</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Date</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courses</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>field_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>name of field on the derived indexing type to store the derived value</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>from</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>path to field on the source type to source values from</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>DerivedIndexedType::MinOrMaxValue</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


247
248
249</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'elasticgraph-schema_definition/lib/elastic_graph/schema_definition/indexing/derived_indexed_type.rb', line 247</span>

<span class='kw'>def</span> <span class='id identifier rubyid_max_value'>max_value</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/MinOrMaxValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::MinOrMaxValue (class)">MinOrMaxValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='symbol'>:max</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="min_value-instance_method">
  
    #<strong>min_value</strong>(field_name, from:)  &#x21d2; <tt>DerivedIndexedType::MinOrMaxValue</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Configures <code>field_name</code> (on the derived indexing type) to contain the minimum of all values from the <code>from</code>
field on the source type.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="../../../ElasticGraph.html" title="ElasticGraph (module)">ElasticGraph</a></span></span><span class='period'>.</span><span class='id identifier rubyid_define_schema'><span class='object_link'><a href="../../../ElasticGraph.html#define_schema-class_method" title="ElasticGraph.define_schema (method)">define_schema</a></span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_schema'>schema</span><span class='op'>|</span>
  <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_object_type'>object_type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>StudentCourseEnrollment</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseId</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseStartDate</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Date</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>student_course_enrollments</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_derive_indexed_type_fields'>derive_indexed_type_fields</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Course</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>from_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseId</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_derive'>derive</span><span class='op'>|</span>
      <span class='id identifier rubyid_derive'>derive</span><span class='period'>.</span><span class='id identifier rubyid_min_value'>min_value</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>firstOfferedDate</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>from:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courseStartDate</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_object_type'>object_type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Course</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>firstOfferedDate</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Date</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>courses</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>field_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>name of field on the derived indexing type to store the derived value</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>from</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>path to field on the source type to source values from</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>DerivedIndexedType::MinOrMaxValue</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


215
216
217</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'elasticgraph-schema_definition/lib/elastic_graph/schema_definition/indexing/derived_indexed_type.rb', line 215</span>

<span class='kw'>def</span> <span class='id identifier rubyid_min_value'>min_value</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='label'>from:</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="DerivedFields.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields (module)">DerivedFields</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="DerivedFields/MinOrMaxValue.html" title="ElasticGraph::SchemaDefinition::Indexing::DerivedFields::MinOrMaxValue (class)">MinOrMaxValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='symbol'>:min</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="painless_script-instance_method">
  
    #<strong>painless_script</strong>  &#x21d2; <tt><span class='object_link'>Scripting::Script</span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>
<p>Returns Painless script that will maintain the derived fields.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'>Scripting::Script</span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Painless script that will maintain the derived fields</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


253
254
255
256
257
258
259
260</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'elasticgraph-schema_definition/lib/elastic_graph/schema_definition/indexing/derived_indexed_type.rb', line 253</span>

<span class='kw'>def</span> <span class='id identifier rubyid_painless_script'>painless_script</span>
  <span class='const'>Scripting</span><span class='op'>::</span><span class='const'>Script</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
    <span class='label'>source:</span> <span class='id identifier rubyid_generate_script'>generate_script</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='comma'>,</span>
    <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='embexpr_end'>}</span><span class='tstring_content'>_from_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_type'>source_type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='label'>language:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>painless</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='label'>context:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>update</span><span class='tstring_end'>&quot;</span></span>
  <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="runtime_metadata_for_source_type-instance_method">
  
    #<strong>runtime_metadata_for_source_type</strong>  &#x21d2; <tt>SchemaArtifacts::RuntimeMetadata::UpdateTarget</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>
<p>Returns runtime metadata for the source type.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>SchemaArtifacts::RuntimeMetadata::UpdateTarget</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>runtime metadata for the source type</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


264
265
266
267
268
269
270
271
272
273
274
275
276
277</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'elasticgraph-schema_definition/lib/elastic_graph/schema_definition/indexing/derived_indexed_type.rb', line 264</span>

<span class='kw'>def</span> <span class='id identifier rubyid_runtime_metadata_for_source_type'>runtime_metadata_for_source_type</span>
  <span class='const'>SchemaArtifacts</span><span class='op'>::</span><span class='const'>RuntimeMetadata</span><span class='op'>::</span><span class='const'>UpdateTarget</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
    <span class='label'>type:</span> <span class='id identifier rubyid_destination_type_ref'>destination_type_ref</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
    <span class='label'>relationship:</span> <span class='kw'>nil</span><span class='comma'>,</span>
    <span class='label'>script_id:</span> <span class='id identifier rubyid_painless_script'>painless_script</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
    <span class='label'>id_source:</span> <span class='id identifier rubyid_id_source'>id_source</span><span class='comma'>,</span>
    <span class='label'>routing_value_source:</span> <span class='id identifier rubyid_routing_value_source'>routing_value_source</span><span class='comma'>,</span>
    <span class='label'>rollover_timestamp_value_source:</span> <span class='id identifier rubyid_rollover_timestamp_value_source'>rollover_timestamp_value_source</span><span class='comma'>,</span>
    <span class='label'>metadata_params:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='label'>data_params:</span> <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:source_field</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
      <span class='lbracket'>[</span><span class='id identifier rubyid_f'>f</span><span class='comma'>,</span> <span class='const'>SchemaArtifacts</span><span class='op'>::</span><span class='const'>RuntimeMetadata</span><span class='op'>::</span><span class='const'>DynamicParam</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>source_path:</span> <span class='id identifier rubyid_f'>f</span><span class='comma'>,</span> <span class='label'>cardinality:</span> <span class='symbol'>:many</span><span class='rparen'>)</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Nov  4 20:05:26 2024 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.3.5).
</div>

    </div>
  </body>
</html>